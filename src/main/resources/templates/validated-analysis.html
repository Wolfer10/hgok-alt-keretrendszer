<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Statisztika</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css}" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link th:href="@{css/stats.css}">
    <link th:href="@{/css/global.css}" rel="stylesheet">
    <script type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<script type="text/javascript"
        src="https://www.gstatic.com/charts/loader.js"></script>

<script th:inline="javascript">
    let datas = []
    google.charts.load('current', {
        packages:['bar']
    }).then( () => drawChart());

    function drawChart() {
        let data = new google.visualization.arrayToDataTable([['Eszköz neve', 'összes', 'helyes'], ...datas]);

        let options = {
            chart: {
                title: 'Tool Performance',
                subtitle: 'Something',
            }
        };

        let piechart = new google.charts.Bar(document.getElementById('chart_div'));
        piechart.draw(data, google.charts.Bar.convertOptions(options));
    }
</script>

<div th:insert="header :: navbar"></div>
<table id="prec-table" class="table">
    <tr>
        <th scope="col">Az eszköz</th>
        <th scope="col">Az eszköz futási ideje</th>
        <th scope="col">Max memória</th>
        <th scope="col">Átlagos memória</th>
        <th scope="col">A helyesen eltalált élek száma:</th>
        <th scope="col">Az eszköz által talált <br/> összes:</th>
        <th scope="col">Általunk talált összes</th>
        <th scope="col">Precizitás</th>
        <th scope="col">Lefedettség</th>
        <th scope="col">F-mesure</th>
    </tr>
    <tr th:each="metric :  ${compared.getMetricContainers()}">
        <td th:text="${metric.getTool().getName()}" > </td>
        <td th:text="${metric.getToolResult().getValidationLength()}"> </td>
        <td th:text="${metric.getToolResult().getMemoryData().getMaxMemory()}"> </td>
        <td th:text="${metric.getToolResult().getMemoryData().getAverageMemory()}"> </td>
        <td th:text="${metric.getTruePositive()}" > </td>
        <td th:text="${metric.getAll()}" > </td>
        <td th:text="${metric.getOurTruePositive()}" > </td>
        <td th:text="${metric.getPrecision() * 100}" > </td>
<!--        TODO: ceil -->
        <td th:text="${metric.getRecall() * 100} + '%'" > </td>
        <td th:text="${metric.getFMeasure() * 100} + '%'"  > </td>
        <script th:inline="javascript">
            /*<![CDATA[*/
            datas.push([ [[${metric.getTool().getName()}]], [[${metric.getAll()}]], [[${metric.getTruePositive()}]] ])
            /*]]>*/
        </script>
    </tr>
    <caption>Precizitás és pontosság metrikái az eszközönöknek</caption>
</table>
<form id="update-our-true-positive" action="#" method="POST" th:action="@{/calculateStats}">
    <label>
        Az általunk talált helyes élek száma:
        <input type="number" name="ourPositive">
    </label>
    <input type="hidden" name="id" th:value="${compared.getId()}">
    <input type="submit" value="frissíts!">
</form>
<div class="container">
    <div id="chart_div"></div>
</div>



</body>

<svg id="my_dataviz" width="960" height="960"></svg>

